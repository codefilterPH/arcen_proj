{% load static %}
<!-- üîπ QR Scanner Modal -->
<div class="modal fade" id="qrScannerModal" tabindex="-1" aria-labelledby="qrScannerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- Header -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="qrScannerModalLabel">
          <i class="fas fa-qrcode me-2"></i> QR Code Scanner
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body bg-light">

        <!-- QR Reader -->
        <div class="text-center mb-3">
          <div id="reader" style="width:100%; max-width:400px; margin:0 auto;"></div>
          <div id="result" class="mt-3 text-muted">Scan a QR code to see the result here</div>
        </div>

        <!-- Student Card -->
        <div id="studentCard" class="card shadow-sm mx-auto" style="max-width:550px; display:none;">
          <div class="card-body text-center">

            <!-- Profile Picture -->
            <img id="studentPhoto"
                 src="{% static 'img/users/img_holder.png' %}"
                 class="rounded-circle mb-3"
                 style="width:120px; height:120px; object-fit:cover; border:3px solid #0d6efd;">

            <h4 class="fw-bold mb-3">Scanned Information</h4>

            <div class="text-start mb-3 ps-3">

              <p class="mb-1"><strong>Name:</strong>
                <span id="studentName">‚Äî</span>
              </p>

              <p class="mb-1"><strong>Rank:</strong>
                <span id="studentRank">‚Äî</span>
              </p>

              <p class="mb-1"><strong>Classification:</strong>
                <span id="studentClass">‚Äî</span>
              </p>

              <p class="mb-1"><strong>Contact No.:</strong>
                <span id="studentContact">‚Äî</span>
              </p>

              <p class="mb-1"><strong>Address:</strong>
                <span id="studentAddress">‚Äî</span>
              </p>

            </div>

            <!-- Attendance Status -->
            <div class="mb-3">
              <label class="fw-bold mb-1">Attendance Status</label>
              <select id="attendanceStatus" class="form-select text-center fw-bold">
                <option value="PRESENT" selected>Present</option>
                <option value="LATE">Late</option>
                <option value="ABSENT">Absent</option>
                <option value="EXCUSED">Excused</option>
                <option value="DISMISSED">Dismissed</option>
              </select>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-center gap-2 mt-3">
              <button class="btn btn-success" onclick="confirmAttendance()">
                <i class="fas fa-check me-1"></i> Confirm
              </button>
              <button class="btn btn-danger" onclick="cancelAttendance()">
                <i class="fas fa-times me-1"></i> Cancel
              </button>
            </div>

          </div>
        </div>

      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i> Close
        </button>
      </div>

    </div>
  </div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script src="{% static 'attendance/js/submit-attendance.js' %}"></script>
<script src="{% static 'attendance/js/qrscanner.js' %}"></script>

<script>
  $(document).ready(function() {

    $("#qrScannerModal").on("shown.bs.modal", function () {
        console.log("üì∏ QR Scanner modal opened.");
        if (typeof initQrScanner === "function") {
            setTimeout(() => initQrScanner(), 300);
        }
    });

    $("#qrScannerModal").on("hidden.bs.modal", function () {
        console.log("‚ùå QR Scanner modal closed.");
        if (typeof stopQrScanner === "function") {
            stopQrScanner();
        }

        // Reset card UI
        $("#studentCard").hide();
        $("#studentPhoto").attr("src", "{% static 'img/users/img_holder.png' %}");
        $("#studentName, #studentRank, #studentClass, #studentContact, #studentAddress, #studentDisplayFormat, #studentDefaultAvatar")
          .text("‚Äî");
      });
  });
</script>
