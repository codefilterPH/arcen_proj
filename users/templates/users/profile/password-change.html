{% extends 'layouts/base.html' %}
{% load static %}
{% block extra_css %}
<style>
    /* Highlight invalid inputs in red */
    .is-invalid {
        border-color: #e3342f !important;
        background-color: #fcebea !important;
    }
</style>
{% endblock %}
{% block content %}
{% block title %}<title>DMS ACCC - Changing Password </title> {% endblock %}

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid">
            <h1 class="h3 mb-4 text-gray-800">Change Password</h1>

            <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <!-- Current Password -->
                        <div class="form-group">
                            <label for="id_old_password">Current Password</label>
                            <div class="input-group">
                                <input type="password" name="old_password" class="form-control form-control-user"
                                       id="id_old_password" placeholder="Enter current password" required>
                                <div class="input-group-append">
                                    <span class="input-group-text pl-4">
                                        <i class="fas fa-eye toggle-password" data-target="#id_old_password"></i>
                                    </span>
                                </div>
                            </div>
                            <!-- Placeholder for error message -->
                            <small class="text-danger error-message" style="display: none;"></small>
                        </div>

                        <!-- New Password -->
                        <div class="form-group">
                            <label for="id_new_password1">New Password</label>
                            <div class="input-group">
                                <input type="password" name="new_password1" class="form-control form-control-user"
                                       id="id_new_password1" placeholder="Enter new password" required>
                                <div class="input-group-append">
                                    <span class="input-group-text pl-4">
                                        <i class="fas fa-eye toggle-password" data-target="#id_new_password1"></i>
                                    </span>
                                </div>
                            </div>
                            <!-- Placeholder for error message -->
                            <small class="text-danger error-message" style="display: none;"></small>
                        </div>

                        <!-- Confirm New Password -->
                        <div class="form-group">
                            <label for="id_new_password2">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" name="new_password2" class="form-control form-control-user"
                                       id="id_new_password2" placeholder="Confirm new password" required>
                                <div class="input-group-append">
                                    <span class="input-group-text pl-4">
                                        <i class="fas fa-eye toggle-password" data-target="#id_new_password2"></i>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <button type="button" id="btnSubmit" class="btn btn-primary btn-user btn-block">
                            Change Password
                        </button>

                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>
</div>
<script src="{% static 'js/users/show-password.js' %}"></script>
<script src="{% static 'js/authentication/change-password.js' %}"></script>
<script src="{% static 'js/utils/swal-messages.js' %}"></script>
{% endblock %}
{% block extra_js %}
<script>
    $(document).ready(function () {
        console.log("Document is ready");

        $("#btnSubmit").on("click", function (event) {
            event.preventDefault(); // Prevent default form submission
            console.log("Change Password button clicked");

            const oldPassword = $("#id_old_password");
            const newPassword1 = $("#id_new_password1");
            const newPassword2 = $("#id_new_password2");

            let hasError = false;

            // Reset previous error styles and messages
            $(".is-invalid").removeClass("is-invalid");
            $(".error-message").hide().text(""); // Hide and reset all error messages

            // Check if passwords match
            if (newPassword1.val() !== newPassword2.val()) {
                console.log("Passwords do not match");
                newPassword1.addClass("is-invalid");
                newPassword2.addClass("is-invalid");

                // Update error message for the second password field
                const errorMessage = newPassword1.closest(".form-group").find(".error-message");
                if (errorMessage.length > 0) {
                    errorMessage.text("Passwords do not match").show();
                } else {
                    console.error("Error message element not found for new_password2");
                }
                hasError = true;
            }

            // Check if old password is empty
            if (!oldPassword.val()) {
                console.log("Old password is empty");
                oldPassword.addClass("is-invalid");

                // Update error message for the old password field
                const errorMessage = oldPassword.closest(".form-group").find(".error-message");
                if (errorMessage.length > 0) {
                    errorMessage.text("Current password is required").show();
                } else {
                    console.error("Error message element not found for old_password");
                }
                hasError = true;
            }

            if (hasError) {
                return; // Exit if there are validation errors
            }

            console.log("Passwords are valid");
            // Perform AJAX or form submission logic here
            passwordChange({
                "current_password": oldPassword.val(),
                "new_password": newPassword1.val(),
                "confirm_password": newPassword2.val(),
            });


        });
    });


</script>
{% endblock %}
