{% extends 'layouts/base.html' %}
{% load static %}
{% block title %}<title>DMS ACCC - Password Reset </title> {% endblock %}

{% block content %}
<div id="layoutSidenav_content">
    <div id="app">
        <main>
            <div class="container-fluid p-5">
                <div class="row justify-content-center mt-5">
                    <div class="col-lg-6 col-md-8 col-sm-10">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0 text-center text-white">Reset Password for {{user.userprofile}}</h4>
                            </div>
                            <div class="card-body">
                                <form method="post" class="needs-validation" novalidate>
                                    {% csrf_token %}

                                    <!-- Error Messages -->
                                    {% if form.non_field_errors %}
                                        <div class="alert alert-danger">
                                            {% for error in form.non_field_errors %}
                                                <p class="mb-0">{{ error }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}

                                    <!-- New Password Field -->
                                    <div class="form-group">
                                        <label for="id_new_password">New Password</label>
                                        <div class="input-group">
                                            <input type="password" name="new_password" id="id_new_password" class="form-control"
                                                   placeholder="Enter new password" required>
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="#id_new_password">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% if form.new_password.errors %}
                                            <small class="text-danger">
                                                {{ form.new_password.errors.0 }}
                                            </small>
                                        {% endif %}
                                    </div>

                                    <!-- Confirm Password Field -->
                                    <div class="form-group">
                                        <label for="id_confirm_password">Confirm Password</label>
                                        <div class="input-group">
                                            <input type="password" name="confirm_password" id="id_confirm_password"
                                                   class="form-control" placeholder="Confirm new password" required>
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="#id_confirm_password">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% if form.confirm_password.errors %}
                                            <small class="text-danger">
                                                {{ form.confirm_password.errors.0 }}
                                            </small>
                                        {% endif %}
                                    </div>

                                    <!-- Buttons -->
                                    <div class="d-flex justify-content-start mt-3 gap-1">
                                        <button type="submit" name="reset_password" class="btn btn-primary mr-1">
                                            <i class="fas fa-key"></i>&nbsp; Change Password
                                        </button>
                                        <a href="{% url 'users:manage_users' %}" class="btn btn-secondary">
                                            <i class="fas fa-undo"></i>&nbsp; Cancel
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    console.log("Document ready: Password toggle initialized.");

    $(".toggle-password").on("click", function (e) {
        e.preventDefault();
        console.log("Eye icon clicked!");

        const targetSelector = $(this).data("target");
        const input = $(targetSelector);

        if (input.length === 0) {
            console.error("Target input not found:", targetSelector);
            return;
        }

        const currentType = input.attr("type");
        const newType = currentType === "password" ? "text" : "password";
        input.attr("type", newType);

        const icon = $(this).find("i");
        if (newType === "text") {
            icon.removeClass("fa-eye").addClass("fa-eye-slash");
            console.log("Password shown for:", targetSelector);
        } else {
            icon.removeClass("fa-eye-slash").addClass("fa-eye");
            console.log("Password hidden for:", targetSelector);
        }
    });
});
</script>
{% endblock %}
