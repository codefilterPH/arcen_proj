{% load static %}
<!-- ========================= -->
<!-- EDIT STUDENT MODAL -->
<!-- ========================= -->
<div class="modal fade"
     id="editStudentModal"
     tabindex="-1"
     aria-labelledby="editStudentModalLabel"
     aria-hidden="true">

  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg rounded-3">

      <!-- ========================= -->
      <!-- MODAL HEADER -->
      <!-- ========================= -->
      <div class="modal-header">
        <h5 class="modal-title d-flex align-items-center gap-2"
            id="editStudentModalLabel">
          <i class="fas fa-user-graduate"></i>
          Edit Student
        </h5>

        <button type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"></button>
      </div>

      <!-- ========================= -->
      <!-- MODAL BODY -->
      <!-- ========================= -->
<div class="modal-body p-0">

  <form id="editStudentForm">

    <div class="container-fluid">
      <div class="row g-0">

        <!-- ================================= -->
        <!-- LEFT: PERSONNEL PROFILE PANEL -->
        <!-- ================================= -->
        <div class="col-lg-3 bg-light border-end p-3 text-center">

          <!-- Profile Photo -->
          <img id="studentProfilePic"
               src="/static/img/users/avatars/default.png"
               class="img-fluid rounded-circle mb-3 shadow d-block mx-auto"
               style="width:140px;height:140px;object-fit:cover;">

          <h6 class="fw-bold mb-0" id="studentFullName">
            STUDENT NAME
          </h6>

          <small class="text-muted d-block mb-2">
            Student Personnel Record
          </small>

          <span class="badge bg-success mb-3" id="studentStatusBadge">
            ACTIVE
          </span>

          <hr>

          <!-- Student ID -->
          <div class="text-start small">
            <div class="fw-semibold text-uppercase text-muted">
              Student ID
            </div>
            <div id="student_id" class="fw-bold"></div>
          </div>

          <hr>

          <!-- QR CODE -->
          <img id="studentQrCode"
               class="img-fluid border rounded p-2 bg-white"
               style="max-width:140px;"
               alt="QR Code">

        </div>

        <!-- ================================= -->
        <!-- RIGHT: PERSONNEL DETAILS -->
        <!-- ================================= -->
        <div class="col-lg-9 p-4">

          <!-- ========================= -->
          <!-- SERVICE / ENROLLMENT -->
          <!-- ========================= -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3 text-primary">
              <i class="fas fa-clipboard-list me-1"></i>
              Enrollment & Service Status
            </h6>

            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Enrollment Status</label>
                <select id="enrollment_status" class="form-select">
                  <option value="pending">Pending</option>
                  <option value="enrolled">Enrolled</option>
                  <option value="on_leave">On Leave</option>
                  <option value="graduated">Graduated</option>
                  <option value="transferred">Transferred</option>
                  <option value="dropped">Dropped</option>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">Account Status</label>
                <select id="is_active" class="form-select">
                  <option value="true">Active</option>
                  <option value="false">Inactive</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ========================= -->
          <!-- IDENTITY -->
          <!-- ========================= -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3 text-primary">
              <i class="fas fa-user me-1"></i>
              Identity Information
            </h6>

            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">First Name</label>
                <input id="first_name" class="form-control" required>
              </div>

              <div class="col-md-4">
                <label class="form-label">Last Name</label>
                <input id="last_name" class="form-control" required>
              </div>

              <div class="col-md-4">
                <label class="form-label">Email</label>
                <input id="student_email" type="email" class="form-control">
              </div>
            </div>
          </div>

          <!-- ========================= -->
          <!-- PERSONAL DATA -->
          <!-- ========================= -->
          <div class="mb-4">
            <h6 class="border-bottom pb-2 mb-3 text-primary">
              <i class="fas fa-address-card me-1"></i>
              Personal Data
            </h6>

            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Middle Name</label>
                <input id="middle_name" class="form-control">
              </div>

              <div class="col-md-4">
                <label class="form-label">Preferred Initial</label>
                <input id="preferred_initial" class="form-control">
              </div>

              <div class="col-md-4">
                <label class="form-label">Extension</label>
                <input id="extension_name" class="form-control">
              </div>

              <div class="col-md-4">
                <label class="form-label">Gender</label>
                <select id="gender" class="form-select">
                  <option value="">‚Äî</option>
                  <option value="M">Male</option>
                  <option value="F">Female</option>
                  <option value="O">Other</option>
                  <option value="N">Non-binary</option>
                  <option value="X">Prefer not to say</option>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">Birth Date</label>
                <input id="birth_date" type="date" class="form-control">
              </div>

              <div class="col-md-4">
                <label class="form-label">Contact Number</label>
                <input id="contact_number"
                       class="form-control"
                       placeholder="09XXXXXXXXX / +639XXXXXXXXX">
              </div>
            </div>
          </div>

          <!-- ========================= -->
          <!-- ACADEMIC / ORG -->
          <!-- ========================= -->
          <div>
            <h6 class="border-bottom pb-2 mb-3 text-primary">
              <i class="fas fa-school me-1"></i>
              Academic & Organizational
            </h6>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Classification</label>
                <select id="classification" class="form-select"></select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Designations</label>
                <select id="designations" class="form-select" multiple></select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Display Name Format</label>
                <select id="display_name_format" class="form-select">
                  <option value="title">Title Case</option>
                  <option value="camel">Upper Camel</option>
                  <option value="upper">UPPERCASE</option>
                  <option value="lower">lowercase</option>
                </select>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </form>
</div>

      <!-- ========================= -->
      <!-- MODAL FOOTER -->
      <!-- ========================= -->
      <div class="modal-footer bg-light d-flex justify-content-between">
        <small class="text-muted">
          Last updated automatically
        </small>

        <div class="d-flex gap-2">
          <button type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal">
            Cancel
          </button>

          <button type="button"
                  form="editStudentForm"
                  class="btn btn-primary"
                  onclick="updateStudentProfile();">
            <i class="fas fa-save me-1"></i> Save Changes
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
<script src="{% static 'js/student/edit-students.js' %}"></script>
<script src="{% static 'js/student/get-student-profile.js' %}"></script>

<script>
  $(document).ready(function () {

    // When Edit Student modal is ABOUT TO OPEN
    $('#editStudentModal').on('show.bs.modal', function (event) {
      const button = event.relatedTarget;

      if (!button) return;

      const studentId = $(button).data('student-id');

      // console.log('üßë‚Äçüéì Editing student ID:', studentId);

      // Optional: store globally for API usage
      window.currentStudentId = studentId;
      loadStudentProfile(studentId);
    });

    // When Edit Student modal is FULLY CLOSED
    $('#editStudentModal').on('hidden.bs.modal', function () {
      // Reload safely after modal closes
      window.location.reload();
    });

  });
</script>
